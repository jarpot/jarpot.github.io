<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        //使用Promise解决回调地狱
        //疯转 发送ajax请求的函数
        function ajax_(url) {
            return new Promise((resolve,reject)=> {
                let ajax_ = new XMLHttpRequest();
                ajax_.open('get', url, true);
                ajax_.send();
                //ajax_.send('username=张三&pass=12345');
                ajax_.onreadystatechange = function () {
                    //进行状态码的判断 readyState 0 1 2 3 4
                    if (ajax_.readyState == 4) {
                        if (ajax_.status == 200) {
                            //请求成功 
                            resolve(ajax_.responseText);
                        } else {
                            //请求失败
                            reject('请求失败');
                        }
                    }
                }
            })
        }
        

        function ajax_1(url,str) {
            return new Promise((resolve,reject)=> {
                let ajax_ = new XMLHttpRequest();
                ajax_.open('get', url, true);
                ajax_.send();
                //ajax_.send('username=张三&pass=12345');
                ajax_.onreadystatechange = function () {
                    //进行状态码的判断 readyState 0 1 2 3 4
                    if (ajax_.readyState == 4) {
                        if (ajax_.status == 200) {
                            //请求成功 
                            str += ajax_.responseText;
                            resolve(str);
                        } else {
                            //请求失败
                            reject('请求失败');
                        }
                    }
                }
            })
        }
        
        //promise的核心改变的不是异步操作的本质，改变的只是异步操作的形式
        //相当于用同步代码的方式去执行异步代码，
        //最终目的：就是增强代码的可读性，条理性。
        let url1 = './111.json';
        let url2 = './222.json';
        let url3 = './333.json';

       let p1 = ajax_(url1).then((success)=>{
            //console.log(success+'第一次');
            /* let jsonObj = JSON.parse(success);
            let n = jsonObj.name;//张三
            let url2 = './222.json?n='+n;*/
            return ajax_1(url2,success);
        },(error)=>{
            console.log(error);
        })
        
        let p2 = p1.then((success)=>{
            //console.log(success);
            return ajax_1(url3,success);
        },(error)=>{})
        
        p2.then((success)=>{
            console.log(success); 
        },(error)=>{})
        /* ajax_(url1).then((success)=>{
            console.log(success+'第一次');
            return ajax_(url2);
        },(error)=>{
            console.log(error);
        }).then((success)=>{
            console.log(success);
            return ajax_(url3);
        },(error)=>{

        }).then((success)=>{
            console.log(success);
            
        },(error)=>{

        }) */


        //使用async+await来完成多层回调
        async function print(){
            let str = '';
            str += await ajax_(url1);
            str += await ajax_(url2);
            str += await ajax_(url3);
           // console.log(str);
            return str;
        }
        let aaa = '';
        print().then(res=>{
            aaa = res;
            console.log(res);
        })

        console.log(aaa);
    </script>
</body>

</html>