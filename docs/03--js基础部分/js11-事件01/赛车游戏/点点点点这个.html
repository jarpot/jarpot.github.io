<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>赛车游戏</title>
		<style type="text/css">
			* {
				margin: 0px;
				padding: 0px;
			}
			
			#body,
			#main,
			#yx {
				width: 1000px;
				height: 700px;
				border: 1px solid black;
			}
			
			#body {
				margin: 30px auto 0px;
				overflow: hidden;
			}
			
			#main button {
				width: 200px;
				height: 100px;
				font-size: 20px;
				position: relative;
				left: 40%;
				top: 60%;
			}
			
			#main {
				background-image: url(img/Road.jpg);
				background-size: 100%;
				background-position: 50%;
			}
			
			#yx {
				display: none;
				position: relative;
				background-image: url(img/Road.jpg);
				background-size: 150%;
				background-position-x: 50%;
			}
			
			#yx h1 {
				float: left;
				color: deepskyblue;
			}
			
			#yx button {
				width: 100px;
				height: 50px;
				float: right;
			}
			
			#me,
			#dr {
				width: 150px;
				height: 200px;
				position: relative;
			}
			
			#me {
				background-image: url(img/mycar.png);
				background-size: 150px 200px;
			}
			
			#dr {
				background-image: url(img/dicar.png);
				background-size: 150px 200px;
			}
			
			#end {
				background-color: white;
				width: 300px;
				font-size: 50px;
				position: relative;
				top: -136px;
				left: 372px;
				display: none;
			}
		</style>
	</head>

	<body>
		<div id="body">
			<div id="main">
				<button onclick="start()">开始游戏</button>
			</div>
			<div id="yx">
				<h1>分数：<span id="score"></span>分</h1>
				<button onclick="ret()">返回</button>
				<div id="me">
				</div>
				<div id="dr">
				</div>
				<div id="end">
					Game over!
				</div>
			</div>
		</div>
		<script type="text/javascript">
			var i = 0;
			function start() {
				document.getElementById("main").style.display = "none";
				document.getElementById("yx").style.display = "block";
				document.getElementById("me").style.left = "45%";
				document.getElementById("me").style.top = "71%";
				document.getElementById("dr").style.top = "-59%";
				document.getElementById("score").innerHTML = "0";
				mycar();
				dicar();
			}

			function ret() {
				document.getElementById("yx").style.display = "none";
				document.getElementById("main").style.display = "block";
				document.getElementById("end").style.display = "none";
			}

			function mycar() {
				var myche = document.getElementById("me").style;
				var shang;
				var zuo;
				document.onkeydown = function(e) {
					for(var i = 0; i < 101; i++)
						if(i + "%" == myche.top)
							shang = i;
						else if(i + "%" == myche.left)
						zuo = i;
					switch(e.keyCode) {
						case 37: //左
							/*if(case 37 > 75){
								document.write(case);
								document.WebGLRenderingContext(case);
							}*/
							if(zuo > 15 && zuo <= 75)
								myche.left = String(zuo - 10) + "%";
							break;
						case 38: //上
							if(shang > 1 && shang <= 71)
								myche.top = String(shang - 10) + "%";
							break;
						case 39: //右
							if(zuo >= 15 && zuo < 75)
								myche.left = String(zuo + 10) + "%";
							break;
						case 40: //下
							if(shang >= 1 && shang < 71)
								myche.top = String(shang + 10) + "%";
							break;
						default:
							break;
					}
				}
			}

			function suiji() {
				while(true) {
					var c = parseInt(Math.random() * 10)
					if(c >= 1 && c <= 7)
						break;
				}
				return c;
			}

			function dicar() {
				var drche = document.getElementById("dr").style;
				var myche = document.getElementById("me").style;
				var myscore = document.getElementById("score");
				var tu = document.getElementById("yx").style;
				var g = 0;
				var i = -59;
				var b = suiji();
				var carks = setInterval(function() {
						drche.left = String(5 + b * 10) + "%";
						i++;
						drche.top = String(i) + "%";
						g -= 5;
						tu.backgroundPositionY = String(g) + "%";
						//读取位置数字信息
						var mytop;
						var myleft;
						for(var j = -100; j < 100; j++) {
							if(String(j) + "%" == myche.top)
								mytop = j;
							if(String(j) + "%" == myche.left)
								myleft = j;
						}
						pd(mytop, myleft, i, 5 + b * 10, carks);
						if(i == 80) {
							{
								myscore.innerHTML = String(Number(myscore.innerHTML) + 10);
								i = -59;
								b = suiji();
							}
						}
					}, 10)
				}

				function pd(a, b, c, d, f) {
					if(a - c >= 0 && a - c < 57 && d - b >= -15 && d - b < 15) {
						document.onkeydown = null;
						clearInterval(f);
						document.getElementById("end").style.display = "block";
					}
				}
		</script>
	</body>
</html>