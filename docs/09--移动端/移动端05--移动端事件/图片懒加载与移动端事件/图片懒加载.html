<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum=1.0,minimum-scale=1.0,user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        ul {
            position: relative;
        }

        li {
            height: 400px;
        }

        div {
            width: 400px;
            height: 400px;
            background-color: red;
        }
    </style>
</head>

<body>
    <!-- 分析
        需求：当图片位于 视口区域内就展示图片，否则，不展示
        假如页面中有8个img标签，我们可以先让 
        这8个img标签都显示一张  默认的图片(空白图)
        当img位于 视口区域内就替换成真正的图片


        两个核心问题：
            怎么判断图片是否位于视口之内？
                取元素距离文档顶部的距离  -  向上滚动的距离 <= 视口的高度
            怎么去换图？
                在img标签中自定义一个属性，存储真正的图片路径
                当满足条件的时候，将 data-url的值 取出来  赋给  src
    -->
    <div></div>
    <ul>
        <li><img class="load" src="./images/bg_pic.png" data-url='./images/cuiyut.jpg'></li>
        <li><img class="load" src="./images/bg_pic.png" data-url='./images/dashuju.jpg'></li>
        <li><img class="load" src="./images/bg_pic.png" data-url='./images/langtut.jpg'></li>
        <li><img class="load" src="./images/bg_pic.png" data-url='./images/mingchaonxs.jpg'></li>
        <li><img class="load" src="./images/bg_pic.png" data-url='./images/musong.jpg'></li>
        <li><img class="load" src="./images/bg_pic.png" data-url='./images/pinang.jpg'></li>
        <li><img class="load" src="./images/bg_pic.png" data-url='./images/xiaowangz.jpg'></li>
        <li><img class="load" src="./images/bg_pic.png" data-url='./images/yelusheleng.jpg'></li>
    </ul>
</body>
<script>
    window.onload = function () {
        //1.取出视口的高度
        var clientH = document.documentElement.clientHeight || document.body.clientHeight;
        //console.log(clientH,window.innerHeight);

        function loadImg() {
            //2.取出向上滚动的距离
            var scrollT = document.documentElement.scrollTop || document.body.scrollTop;
            //console.log(scrollT);
            //3.先获取到所有需要懒加载的图片 通过遍历取出 当前图片到文档顶部的距离
            var imgs = document.getElementsByClassName('load');
            for (var i = 0; i < imgs.length; i++) {
                //判断条件 ：取元素距离文档顶部的距离  -  向上滚动的距离 <= 视口的高度
                //offsetTop 获取 当前元素 距离其定位父元素的上边界的距离
                if (offsetT( imgs[i] ).top  - scrollT <= clientH && imgs[i].getAttribute('data-url')) {
                    //换图操作
                    imgs[i].src = imgs[i].getAttribute('data-url');

                    //每一次换图后，直接把当前元素的data-url属性删除掉
                    imgs[i].removeAttribute('data-url');
                }
            }
        }

        //封装方法：获取元素到文档顶部的距离
        function offsetT(element) {
            var pos = {
                left: 0,
                top: 0
            }
            //获取当前元素的定义父元素
            var parents = element.offsetParent;
            pos.left += element.offsetLeft;
            pos.top += element.offsetTop

            //当当前元素的定位父元素存在，并且 不是 根html/body的时候  循环接着往下进行
            while (parents && !/html|body/i.test(parents.tagName)) {
                pos.left += parents.offsetLeft;
                pos.top += parents.offsetTop;

                parents = parents.offsetParent;
            }
            return pos;
        }

        //页面加载完成时，可能已经有一些图片位于视口区域内了，所以要先把这些图片加载出来
        loadImg();
        //只要页面滚动就调用函数
        window.onscroll = loadImg;
    }
</script>

</html>